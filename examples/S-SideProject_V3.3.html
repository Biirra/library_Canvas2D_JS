<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <style>
    #canvas {
        position: fixed;
        width: 100%;
        height: 100%;
        top:0;
        left:0;
    }
  </style>
</head>
<body>
    <canvas id="canvas" style="border:1px solid lightgrey;">
        Your browser does not support the HTML5 canvas tag.
    </canvas>
<div style="display:none;">
    <img id="watermark" src="img\AP_beeldmerk_kleur.png" />
    <img id="trademark" src="img/AP_trademark.png" width="300" height="227" />
</div>
<script>
// Listen to the onLoad event, then create a game world
window.onload = function (){

    let gameWorld = new World('canvas');
    


}

const DEBUG = false;
const OBJECT_SPEED_MULTIPLIER = 0;

const watermark = document.getElementById("watermark");

const DATA = {
    apis: {
        id: 'apis',
        collisionid: -1,
        text: {
            content: "APIS!",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 800,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: [], 
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -350,
                y: -350,
                w: 700,
                h: 700
            }
        },
        associates: {
            ids: ['xms', 'oms', 'ams', 'rms', 'apam'],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    oms: {
        id: 'oms',
        collisionid: 1,
        text: {
            content: "OMS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 300,
        y: 250,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: ['meldkamer', 'neninsp', 'timesheet', 'maxigis', 'vgm'], 
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -400,
                y: -400,
                w: 800,
                h: 800
            }
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    ams: {
        id: 'ams',
        collisionid: 1,
        text: {
            content: "AMS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 1350,
        y: 250,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: ['poplusschema', 'fmecatwo', 'expertsystems'], 
            line: {
                color: "#FFFF00",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -350,
                y: -350,
                w: 700,
                h: 700
            }
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    rms: {
        id: 'rms',
        collisionid: 1,
        text: {
            content: "RMS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 900,
        y: 200,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: ['vtw', 'eisen', 'afwijkingen', 'brijfsrisico'], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -350,
                y: -350,
                w: 700,
                h: 700
            }
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    apam: {
        id: 'apam',
        collisionid: 1,
        text: {
            content: "APAM",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 500,
        y: 750,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: ['qcontrol', 'sdecompensition', 'changemanagment', 'industryacc'], 
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -350,
                y: -350,
                w: 700,
                h: 700
            }
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    xms: {
        id: 'xms',
        collisionid: 1,
        text: {
            content: "X-MS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 1000,
        y: 750,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: ['pms', 'wms', 'sms'], 
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -350,
                y: -350,
                w: 700,
                h: 700
            }
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    meldkamer: {
        id: 'meldkamer',
        collisionid: -1,
        text: {
            content: "Meldkamer",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 50,
        y: 150,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: [], 
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -350,
                y: -350,
                w: 700,
                h: 700
            }
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    neninsp: {
        id: 'neninsp',
        collisionid: -1,
        text: {
            content: "NEN-Inspections",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 50,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50,
        children: {
            ids: [], 
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: -350,
                y: -350,
                w: 700,
                h: 700
            }
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [20, 20]
                }
            },
        },
    },
    timesheet: {
        id: 'timesheet',
        collisionid: -1,
        text: {
            content: "Timesheet",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 250,
        y: 50,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    maxigis: {
        id: 'maxigis',
        collisionid: -1,
        text: {
            content: "MaxiGIS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 450,
        y: 100,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: ['poplusschema'],
            line: {
                color: "#0000FF",
                width: 0.5,
                maxLength: 220,
                dashed: {
                    active: true,
                    data: [5, 5]
                }
            },
        },
    },
    vgm: {
        id: 'vgm',
        collisionid: -1,
        text: {
            content: "VGM",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    poplusschema: {
        id: 'poplusschema',
        collisionid: -1,
        text: {
            content: "PO+ Schema",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#FF0000",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    fmecatwo: {
        id: 'fmecatwo',
        collisionid: -1,
        text: {
            content: "FMECA 2.0",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    expertsystems: {
        id: 'expertsystems',
        collisionid: -1,
        text: {
            content: "Expert Systems",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    vtw: {
        id: 'vtw',
        collisionid: -1,
        text: {
            content: "VTW",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 900,
        y: 50,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    eisen: {
        id: 'eisen',
        collisionid: -1,
        text: {
            content: "Eisen",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 1200,
        y: 50,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    afwijkingen: {
        id: 'afwijkingen',
        collisionid: -1,
        text: {
            content: "Afwijkingen",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    brijfsrisico: {
        id: 'brijfsrisico',
        collisionid: -1,
        text: {
            content: "Bedrijf's/Risico Matrix",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    qcontrol: {
        id: 'qcontrol',
        collisionid: -1,
        text: {
            content: "Q.Control",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    sdecompensition: {
        id: 'sdecompensition',
        collisionid: -1,
        text: {
            content: "Standaard decompositie",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    changemanagment: {
        id: 'changemanagment',
        collisionid: -1,
        text: {
            content: "Change managment",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    industryacc: {
        id: 'industryacc',
        collisionid: -1,
        text: {
            content: "Industry accelerators",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    pms: {
        id: 'pms',
        collisionid: -1,
        text: {
            content: "PMS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    wms: {
        id: 'wms',
        collisionid: -1,
        text: {
            content: "WMS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },
    sms: {
        id: 'sms',
        collisionid: -1,
        text: {
            content: "SMS",
            color: "#095076",
            size: 30,
            font: 'Arial'
        },
        x: 400,
        y: 450,
        vx: 0,
        vy: 0,
        height: 50, 
        width: 50, 
        children: {
            ids: [], 
            line: {
                color: "#FF00FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
            bbox: {
                color: '#FF0000',
                x: 0,
                y: 0,
                w: 0,
                h: 0
            },
        },
        associates: {
            ids: [],
            line: {
                color: "#0000FF",
                width: 1,
                maxLength: 220,
                dashed: {
                    active: false,
                    data: []
                }
            },
        },
    },

}


class World {
    constructor(canvasId){
        this.canvas = null;
        this.context = null;
        this.secondsPassed = 0;
        this.oldTimeStamp = 0;
        this.gameObjects = [];
        this.resetCounter = 0;

        this.init(canvasId);
    }

    init(canvasId) {
        this.canvas = document.getElementById(canvasId);
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;

        this.context = this.canvas.getContext('2d');

        this.createWorld();

        // Request an animation frame for the first time
        // The gameLoop() function will be called as a callback of this request
        window.requestAnimationFrame((timeStamp) => {this.gameLoop(timeStamp)});
    }

    createWorld() {
        // create all the items
        const dataKeys = Object.keys(DATA);
        for(let i = 0; i < dataKeys.length; i++){
            const currData = DATA[dataKeys[i]];

            // change width and heigth to the content.
            this.context.save();
            this.context.font = `${currData.text.size}px ${currData.text.font}`;

            // set the width based on the text.
            const textWidth = this.context.measureText(currData.text.content).width;
            currData.width = textWidth;

            // set the heigth based on text size.
            const textHeight = this.context.measureText('M').width; // a very close estimate 
            currData.height = textHeight;

            this.context.restore();

            // set velocity at random
            const random = Vector2d.random(OBJECT_SPEED_MULTIPLIER);
            let vy = random.y;
            let vx = random.x;
            
            currData.vx = vx;
            currData.vy = vy
            
            
            
            const textItem = new TextItem(this.context, currData);
            this.gameObjects.push(textItem);

            if(textItem.id === 'apis'){

            
                
                console.log(textItem.width)
                console.log(this.canvas.width)
                textItem.x = this.canvas.width/2 - textItem.width/2;
                textItem.y = this.canvas.height/2 - textItem.height/2;
                textItem.vx = 0;
                textItem.vy = 0;
            }

        }

        // set the children 
        for(let i = 0; i < dataKeys.length; i++){
            const currObj = DATA[dataKeys[i]];
            const parentObj = this.getObjById(currObj.id);

            
            // set children for each Item
            if(currObj.children.ids.length > 0){
                for(let j = 0; j < currObj.children.ids.length; j++){
                    const currChildId = currObj.children.ids[j];
                    const currChildObj = this.getObjById(currChildId);

                    parentObj.children.objs.push(currChildObj);
                }
            }

            // set associates for each Item
            if(currObj.associates.ids.length > 0){
                for(let j = 0; j < currObj.associates.ids.length; j++){
                    const currChildId = currObj.associates.ids[j];
                    const currChildObj = this.getObjById(currChildId);

                    parentObj.associates.objs.push(currChildObj);
                }
            }            
        }

    }

    gameLoop(timeStamp) {
        // Calculate how much time has passed
        this.secondsPassed = (timeStamp - this.oldTimeStamp) / 1000;
        this.oldTimeStamp = timeStamp;

        

        //this.detectCollisions(); // detect collisions with other items.
        this.bounceEdges(); // makes sure everything stay's in screen

        this.clearCanvas();

        // Loop over all game objects to update
        for (let i = 0; i < this.gameObjects.length; i++) {


            this.gameObjects[i].bounceChildrenFromParentBBox();
            this.gameObjects[i].update(this.secondsPassed);

            
        }

        // Loop over all game objects to draw
        for (let i = 0; i < this.gameObjects.length; i++) {
            const currObj = this.gameObjects[i];
            currObj.draw();
            currObj.drawLinesToChildren();
            currObj.drawLinesToAssociates();

            if(DEBUG){
                currObj.drawBBoxForChildren();
            }
        }


        // The loop function has reached it's end
        // Keep requesting new frames
        window.requestAnimationFrame((timeStamp) => this.gameLoop(timeStamp));
    }
    /*
    the pixel bounces of the border and gos at the same speed and acceleration.
    */
    bounceEdges(){

        for(let i = 0; i < this.gameObjects.length; i++){
            const currObj = this.gameObjects[i];

            // mirror on the x axis
            if (currObj.x + currObj.width > this.canvas.width) {

                // Mirror the velocity
                currObj.vx = -currObj.vx;

            } else if (currObj.x < 0) {

                // Mirror the velocity
                currObj.vx = -currObj.vx;
            }

            // mirror on the y axis
            if (currObj.y + currObj.height  > this.canvas.height) { 

                // Mirror the velocity
                currObj.vy = -currObj.vy;

            } else if (currObj.y  < 0) { 

                // Mirror the velocity
                currObj.vy = -currObj.vy;
            }
        }
    }

    detectCollisions() {
        let obj1;
        let obj2;

        for (let i = 0; i < this.gameObjects.length; i++) {
            this.gameObjects[i].isColliding = false;
        }

        for (let i = 0; i < this.gameObjects.length; i++)
        {
            obj1 = this.gameObjects[i];
            for (let j = i + 1; j < this.gameObjects.length; j++)
            {
                obj2 = this.gameObjects[j];

                if(obj1.id === obj2.id) continue; // don't collide with yourself.
                if(obj1.collisionid !== obj2.collisionid) continue; // don't collide with objects of diffrent collision id's
                if(obj1.collisionid === -1 || obj2.collisionid === -1) continue; // collision id -1 does not collide with anything other objects.

                if (this.rectIntersect(obj1.x, obj1.y, obj1.width, obj1.height, obj2.x, obj2.y, obj2.width, obj2.height)) {
                    obj1.isColliding = true;
                    obj2.isColliding = true;

                    let vCollision = {x: obj2.x - obj1.x, y: obj2.y - obj1.y};
                    let distance = Math.sqrt((obj2.x-obj1.x)*(obj2.x-obj1.x) + (obj2.y-obj1.y)*(obj2.y-obj1.y));
                    let vCollisionNorm = {x: vCollision.x / distance, y: vCollision.y / distance};
                    let vRelativeVelocity = {x: obj1.vx - obj2.vx, y: obj1.vy - obj2.vy};
                    let speed = vRelativeVelocity.x * vCollisionNorm.x + vRelativeVelocity.y * vCollisionNorm.y;

                    if (speed < 0) {
                        break;
                    }

                    
                    obj1.vx -= (speed * vCollisionNorm.x);
                    obj1.vy -= (speed * vCollisionNorm.y);
                    obj2.vx += (speed * vCollisionNorm.x);
                    obj2.vy += (speed * vCollisionNorm.y);
                }
            }
        }
    }

    rectIntersect(x1, y1, w1, h1, x2, y2, w2, h2) {

        // Check x and y for overlap
        if (x2 > w1 + x1 || x1 > w2 + x2 || y2 > h1 + y1 || y1 > h2 + y2){
            return false;
        }

        return true;
    }

    clearCanvas() {
        // Clear the canvas
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);

        this.context.save();
        this.context.fillStyle = '#FFFFFF';
        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);
        this.context.globalAlpha = 0.4;
        this.context.drawImage(watermark, 0, 0, 605, 605, this.canvas.width/2 - watermark.width/2 , this.canvas.height/2 - watermark.height/2, watermark.width, watermark.height);
        this.context.globalAlpha = 1;
        this.context.restore();
    }

    getObjById(id){
        const result = this.gameObjects.find(x => x.id === id);
        return result;
    }
}

class Item
{
    constructor (context, x, y, width, height, vx = 0, vy = 0, mass = 1){
        this.context = context;
        this.x = x;
        this.y = y;

        this.vx = vx;
        this.vy = vy;
        this.mass = mass;

        this.isColliding = false;

        //Set default width and height
        this.width = width;
        this.height = height;
    }

    draw(){
        if(!DEBUG) return;
        //Draw a simple square
        this.context.strokeStyle = this.isColliding?'#ff8080':'#0099b0';
        this.context.strokeRect(this.x, this.y, this.width, this.height);
    }

    update(secondsPassed){
        //Move with set velocity

        const maxspeed = 150;

        if(this.vx > maxspeed){
            this.vx = maxspeed;
        }
        if(this.vy > maxspeed){
            this.vy = maxspeed;
        }
        if(this.vx < -maxspeed){
            this.vx = -maxspeed;
        }
        if(this.vy < -maxspeed){
            this.vy = -maxspeed;
        }
        this.x += this.vx * secondsPassed;
        this.y += this.vy * secondsPassed;

    }
}

class TextItem extends Item{
    constructor(context, data){
        super(context, data.x, data.y, data.width, data.height, data.vx, data.vy);

        this.id = data.id;
        this.collisionid = data.collisionid;
        
        this.text = {
            content: data.text.content,
            color: data.text.color,
            size: data.text.size,
            font: data.text.font
        }

        this.children = {
            objs: [],
            line: {
                color: data.children.line.color,//"#FF00FF",
                width: data.children.line.width,
                dashed: {
                    active: data.children.line.dashed.active,
                    data: data.children.line.dashed.data
                }
            },
            bbox: {
                color: data.children.bbox.color, //'#FF0000',
                x: data.children.bbox.x,
                y: data.children.bbox.y,
                w: data.children.bbox.w,
                h: data.children.bbox.h
            }
        }
        this.associates = {
            objs: [],
            line: {
                color: data.associates.line.color,
                width: data.associates.line.width,
                dashed: {
                    active: data.associates.line.dashed.active,
                    data: data.associates.line.dashed.data
                }
            },
        }

    }
    bounceChildrenFromParentBBox(){
        const bbox = this.children.bbox;
        
        for(let i = 0; i < this.children.objs.length; i++){
            const currChild = this.children.objs[i];
            // minus cause its up

            const bboxTop       = this.y + bbox.y + this.height/2;
            const bboxBottom    = this.y + bbox.h/2 + this.height/2;

            const bboxLeft      = this.x + bbox.x + this.width/2;
            const bboxRight     = this.x + bbox.w/2 + this.width/2;

            const childTop = currChild.y;
            const childBottom = currChild.y + currChild.height;
            const childLeft = currChild.x;
            const childRight = currChild.x + currChild.width;

            const speed = Vector2d.random(50);
            const remVelCurrChildX = currChild.vx;
            const remVelCurrChildY = currChild.vy;

            const offset = 2;

            if(childTop <= bboxTop){
                //console.log("Child hits Top");
                //currChild.y = bboxTop + 1;
                //currChild.vy = (currChild.vy + this.vy) * -1;
                currChild.vy = (this.vy + currChild.vy) + speed.y;
                currChild.y = bboxTop  + offset;
                
            }
            else if(childBottom >= bboxBottom){
                //console.log("Child hits Bottom");
                //currChild.y = bboxBottom - currChild.height -1;
                //currChild.vy = (currChild.vy + this.vy) * -1;

                currChild.vy = (this.vy - currChild.vy) + speed.y;
                currChild.y = bboxBottom - currChild.height - offset;
                
            }
            if(childLeft <= bboxLeft){
                //console.log("Child hits Left");
                //currChild.x = bboxLeft + 1;
                //currChild.vx = (currChild.vx + this.vx) * -1;

                //console.log(currChild.id, currChild.vx)
                currChild.vx = (this.vx + currChild.vx) + speed.x;
                currChild.x = bboxLeft + offset;
                
                //console.log(currChild.id,currChild.vx)
                
            }
            else if(childRight >= bboxRight){
                //console.log("Child hits Right");
                //currChild.x = bboxRight - currChild.width - 1;
                //currChild.vx = (currChild.vx + this.vx) * -1;

                currChild.vx = (this.vx - currChild.vx) + speed.x;
                currChild.x = bboxRight - currChild.width - offset;
                
            }
        }
    }
    drawBBoxForChildren(){
        // draw inner orbital boundry box
        if(this.children.objs.length == 0) return;
        this.context.save();
        this.context.strokeStyle = this.children.bbox.color;
        this.context.lineWidth = this.children.line.width;
        this.context.translate(this.x, this.y);
        this.context.strokeRect( this.children.bbox.x + (this.width/2), this.children.bbox.y + (this.height/2), this.children.bbox.w, this.children.bbox.h);
        this.context.restore();
    }
    draw(){
        super.draw();

        this.context.save();
        this.context.translate(this.x, this.y);

        // draw the pixel name
        this.context.fillStyle = this.text.color;
        this.context.font = `${this.text.size}px ${this.text.font}`;
        
        this.context.fillText(this.text.content, 0, this.height);
        this.context.restore();
    }
    drawLinesToChildren(){
        if(this.children.objs.length > 0){
            
            for(let i = 0; i < this.children.objs.length; i++){
                const currChild = this.children.objs[i];
                // teken een lijn tussen zichzelf en de child
                this.context.save();
                this.context.strokeStyle = this.children.line.color;
                this.context.lineWidth = this.children.line.width;
                this.context.beginPath();
                this.context.moveTo(this.x + (this.width/2), this.y + (this.height/2));
                this.context.lineTo(currChild.x + (currChild.width/2), currChild.y + (currChild.height/2));
                this.context.stroke();
                this.context.restore();
            }
        }
    }
    drawLinesToAssociates(){

        if(this.associates.objs.length > 0){
            for(let i = 0; i < this.associates.objs.length; i++){
                const currChild = this.associates.objs[i];

                // teken een lijn tussen zichzelf en de child
                this.context.save();
                this.context.strokeStyle = this.associates.line.color;
                this.context.lineWidth = this.associates.line.width;
                if(this.associates.line.dashed.active){
                    this.context.setLineDash(this.associates.line.dashed.data);
                }
                this.context.beginPath();
                this.context.moveTo(this.x + (this.width/2), this.y + (this.height/2));
                this.context.lineTo(currChild.x + (currChild.width/2), currChild.y + (currChild.height/2));
                this.context.stroke();
                this.context.restore();
            }
        }
    }
}


class Vector2d{
    constructor(x = 0, y = 0){
        this.x = x;
        this.y = y;
    }
    add(vector2d) {
        this.x += vector2d.x;
        this.y += vector2d.y;
    };
    sub(vector2d) {
        this.x -= vector2d.x;
        this.y -= vector2d.y;
    };
    mult(mult) {
        this.x *= mult;
        this.y *= mult;
    };
    div(div) {
        this.x /= div;
        this.y /= div;
    };
    mag() {
        return Math.sqrt(this.x * this.x, this.y * this.y);
    };
    norm() {
        const mag = this.mag();
        return new Vector2d(this.x/mag, this.y/mag);
    };
    heading(){
        var h = Math.atan2(this.y, this.x);
        return h;
    }
    /**
     * Get a copy of this object. 
     * @returns {Vector2d} Returns a copy of this.
     */ 
    copy(){
        return new Vector2d(this.x, this.y);
    }
    /**
     * Subtract two Vector2d's from eachother.
     * @param   {Vector2d} v1 
     * @param   {Vector2d} v2 
     * @returns {Vector2d}      Contains a new Vector2d with combined values.
     */
    static sub(v1, v2){
        return new Vector2d(v1.x - v2.x, v1.y - v2.y);
    }
    static zero(){
        return new Vector2d(0,0);
    };
    static random(multiplier = 1){
        // return a random Vector2d
        let vector;
        let random = Math.random();
        if (random <= 0.25) {
            vector = new Vector2d(-Math.random() * multiplier, -Math.random() * multiplier);
        } else if (random > 0.25 && random <= 0.5) {
            vector = new Vector2d(-Math.random() * multiplier, Math.random() * multiplier);
        } else if (random > 0.5 && random <= 0.75) {
            vector = new Vector2d(Math.random() * multiplier, -Math.random() * multiplier);
        } else {
            vector = new Vector2d(Math.random() * multiplier, Math.random() * multiplier);
        }
        return vector;
    }
}
</script>
</body>
</html>