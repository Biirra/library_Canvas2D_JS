<html>
    <head>
            <script src="../Lib_2D_JS_Biirra_Core.js"></script>
            <script src="../Lib_2D_JS_Biirra_Base.js"></script>
            <script src="../Lib_2D_JS_Biirra_Experimental.js"></script>
    </head>
    <body>
        <canvas id="field" width="1024" height="1024"></canvas>
    </body>
    <script>
        let canvas = document.getElementById("field");
        let ctx = canvas.getContext("2d");

        let earthImage = new Image();
        earthImage.src = "../assets/Earth1024x1024_256Frames.png"; // source: https://s3.us-east-2.amazonaws.com/singular-assets/Global/Earth1024x1024_256Frames.png

        let sprite = new Animated_Sprite({
            context:ctx,                                // The context.
            texture:earthImage,                         // The image. May be a Image or a string of the source.
            sourceFrame: new Rect({                     // The rectangle data of the selection it will take from the texture image.
                location: Vector2d.zero,                // Top right location of the selected area on the image.
                width: 64,                              // The height of the selected area on the image.
                height: 64                              // The widht of the selected area on the image.
            }),           
            bodyOptions: new Rect({                     // The rectangle that defines the body of the sprite. Contains data on where to write the sprite on the canvas.
                location: Vector2d.zero,              // The location where to draw the selected area on the canvas.
                width: 64,                              // The width that scales the selected area.
                height: 64,                             // The height that scales the selected area.
                anchor: new Vector2d(0,0),          // The center of the sprite's body. Vector.one = bottom right corner.
                scale: new Vector2d(1,1)                // The scale of the sprite's body.
            }),
            ticksPerFrame: 0.2,                  // Try to keep it above 0.2 for perfermance reasons. else it will stutter on the while loop.
            numberOfFrames: 16,                         // The amount of frames horizontaly on the spritesheet. Left to right.
            numberOfRows: 16,                           // The amount of frames vertically on the spritesheet. Top to bottom.
            loop: true,                                 // The animation will start over if its finished.
            reverse: false                              // Play the animation in reverse
        });

        let particleEarth = new Particle({
            sprite: sprite,                         // the sprite it will spawn. Can be sprite or animated sprite.
            mass: 1,
            fadeOut: true,                          // Particle will fade out if its time to die.
            fadeOutSpeed: 0.05,                     // The speed at which the particle fades out. 
            ticksAlive: 100,                         // The time in ticks it stays alive before dissapearing. 

            type: "Default"                         // Use a pre-programmed behavior
        },{});

        // after 600 objects performance becomes noticable.
        let ps = new ParticleSystem({
            location: new Vector2d(canvas.width/2, canvas.height/2),    // Birth location of the particles
            maxNumberOfParticles: 1000,                                  // Max number of particles the system can spawn at a given moment.
            spawnSpeed: 1,                                             // How many updates before it will spawn a new batch of particles.
            batchSize: 6,                                               // The amount of particles it will spawn when it is time to add particles.
            originParticle: particleEarth,                              // The particle it will try to create copy's of
            paused : false                                              // Spawning new particles is halted. Particle system can still die if it has no particles. 
        });

        loop();
        function loop () {
            ctx.clearRect(0, 0, 1024, 1024);
            ps.update();
            ps.renderChildren();            
            
            window.requestAnimationFrame(loop);
        }        
    </script>
</html>